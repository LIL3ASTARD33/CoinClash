<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Coin Clash</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ----------- GLOBAL ----------- */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #0f1923;
  color: #ffffff;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
  position: relative;
  overflow-x: hidden;
  padding: 16px;
}

.background-cityscape {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 40vh;
  z-index: 0;
  opacity: 0.15;
  pointer-events: none;
}

.game-container {
  background: #1a2c38;
  border-radius: 20px;
  padding: 40px;
  width: 100%;
  max-width: 460px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  z-index: 1;
}

@media (max-width: 768px) {
  .game-container {
    padding: 28px;
    max-width: 100%;
    border-radius: 16px;
  }
}

@media (max-width: 480px) {
  .game-container {
    padding: 20px;
    border-radius: 12px;
  }
}
h1 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 28px;
  color: #ffffff;
  font-size: 32px;
  font-weight: 800;
  letter-spacing: -0.5px;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

@media (max-width: 480px) {
  h1 {
    font-size: 26px;
    margin-bottom: 20px;
  }
}

/* ----------- BALANCE ----------- */
.balance-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
  font-size: 14px;
  font-weight: 500;
  opacity: 0.9;
  color: rgba(255, 255, 255, 0.7);
}
.balance-value {
  font-weight: 700;
  font-size: 18px;
  color: #4ade80;
}

/* ----------- INPUTS ----------- */
label { font-size: 14px; font-weight: 600; display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.8); }
input, button {
  width: 100%; padding: 14px 18px; margin-bottom: 14px;
  border-radius: 10px; border: none; font-size: 15px;
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
input {
  background: rgba(255, 255, 255, 0.05);
  color: #ffffff;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.2s ease;
}
input:focus {
  outline: none;
  border-color: #0ea5e9;
  background: rgba(255, 255, 255, 0.08);
}
button {
  background: #0ea5e9;
  color: white;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  border: none;
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
}
button:hover:not(:disabled) {
  background: #0284c7;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(14, 165, 233, 0.4);
}
button:active:not(:disabled) {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);
}
button:disabled { 
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* ----------- MULTIPLIERS ----------- */
.multiplier-row { margin-bottom: 16px; }
.multiplier-label { font-size: 14px; margin-bottom: 6px; color: rgba(255, 255, 255, 0.7); font-weight: 500; }
#multDisplay { 
  color: #22d3ee; 
  font-weight: 700;
  font-size: 18px;
}

/* ----------- CHOICE BUTTONS ----------- */
.choice-row { margin-bottom: 16px; }
.choice-label { font-size: 14px; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-weight: 500; }
.choice-buttons {
  display: flex; gap: 10px;
}
.choice-btn {
  flex: 1;
  padding: 14px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.05);
  color: rgba(255, 255, 255, 0.8);
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  text-align: center;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(255, 255, 255, 0.1);
}
.choice-btn.active {
  background: #0ea5e9;
  border-color: #0ea5e9;
  color: #ffffff;
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
  transform: scale(1.02);
}
.choice-btn:hover:not(.active) {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.2);
  transform: translateY(-1px);
}

/* ----------- COIN & ANIMATION ----------- */
.coin-area {
  margin: 24px 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  height: 200px;
  position: relative;
  overflow: visible;
}

.coin {
  width: 100px; height: 100px;
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  font-weight: 700;
  border: 4px solid rgba(251, 191, 36, 0.6);
  position: absolute;
  bottom: 50px;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 6px 16px rgba(251, 191, 36, 0.4), 0 0 20px rgba(251, 191, 36, 0.2);
  color: #ffffff;
}

@media (max-width: 480px) {
  .coin {
    width: 80px;
    height: 80px;
    font-size: 28px;
    border: 3px solid rgba(251, 191, 36, 0.6);
  }
}

.hand {
  position: absolute;
  bottom: 0;
  width: 60px;
  height: 60px;
  font-size: 50px;
  opacity: 0;
  transform: translateY(20px);
}

.hand.flicking {
  animation: handFlick 1.2s cubic-bezier(.29,.59,.42,1.35) forwards;
}

@keyframes handFlick {
  0%   { opacity: 0; bottom: 0; transform: translateY(20px) rotate(0deg); }
  15%  { opacity: 1; bottom: 20px; transform: translateY(0) rotate(-10deg); }
  30%  { opacity: 1; bottom: 40px; transform: translateY(-10px) rotate(15deg); }
  45%  { opacity: 0.8; bottom: 50px; transform: translateY(-15px) rotate(0deg); }
  60%  { opacity: 0; bottom: 60px; transform: translateY(-20px) rotate(-5deg); }
  100% { opacity: 0; bottom: 60px; transform: translateY(-20px) rotate(-5deg); }
}

/* Cartoon "motion trail" behind coin */
.motion-trail {
  position: absolute;
  width: 90px;
  height: 20px;
  background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
  border-radius: 20px;
  opacity: 0;
  transform: rotate(-20deg);
  pointer-events: none;
}

/* Toss animation */
.coin.tossing {
  animation: coinToss 1.2s cubic-bezier(.29,.59,.42,1.35) forwards;
}
.motion-trail.active {
  animation: trailFlash 0.4s ease forwards;
}

/* Coin spins fast in cartoon style */
@keyframes coinToss {
  0%   { bottom: 50px; transform: rotateY(0deg) scale(1); filter: brightness(1); }
  25%  { bottom: 180px; transform: rotateY(360deg) scale(1.15); filter: brightness(1.2); }
  50%  { bottom: 200px; transform: rotateY(720deg) scale(1.1); filter: brightness(1.3); }
  70%  { bottom: 80px; transform: rotateY(1080deg) scale(0.95); filter: brightness(1.1); }
  85%  { bottom: 55px; transform: rotateY(1260deg) scale(1.02); filter: brightness(1); }
  100% { bottom: 50px; transform: rotateY(1440deg) scale(1); filter: brightness(1); }
}

@keyframes trailFlash {
  0% { opacity: 0; transform: translateX(0) rotate(-20deg); }
  50% { opacity: 1; transform: translateX(-30px) rotate(-20deg); }
  100% { opacity: 0; transform: translateX(-60px) rotate(-20deg); }
}

.coin-label { 
  font-size: 14px; 
  font-weight: 500; 
  color: rgba(255, 255, 255, 0.6); 
  margin-top: 120px;
}

.result { text-align: center; min-height: 22px; margin-bottom: 10px; font-size: 14px; font-weight: 500; }
.result.win { 
  color: #4ade80;
  font-weight: 700;
  font-size: 16px;
  text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
  animation: winPulse 0.6s ease;
}
.result.lose { 
  color: #ef4444;
  font-weight: 700;
  font-size: 16px;
  text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
  animation: losePulse 0.6s ease;
}

@keyframes winPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes losePulse {
  0%, 100% { transform: scale(1); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

.error { 
  font-size: 13px; 
  color: #ef4444; 
  min-height: 18px; 
  margin-bottom: 8px;
  font-weight: 500;
}

.info-line { 
  font-size: 12px; 
  text-align: center; 
  font-weight: 500;
  color: rgba(255, 255, 255, 0.5); 
  margin-top: 8px;
}
.fairness { 
  font-size: 11px; 
  opacity: 0.5; 
  margin-top: 12px; 
  word-break: break-all; 
  color: rgba(255, 255, 255, 0.6);
  text-align: center;
  line-height: 1.4;
}

/* ----------- PROVABLY FAIR SECTION ----------- */
.provably-fair-section {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  padding: 20px;
  margin-top: 16px;
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.provably-fair-section h3 {
  font-size: 16px;
  margin: 0 0 16px 0;
  color: #ffffff;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
}

.fair-info-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.fair-info-row:last-child {
  border-bottom: none;
}

.fair-info-label {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
  flex-shrink: 0;
  margin-right: 12px;
}

.fair-info-value {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  word-break: break-all;
  text-align: right;
  font-family: 'Courier New', monospace;
}

.verify-btn {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  margin-bottom: 0;
  background: rgba(14, 165, 233, 0.2);
  color: #0ea5e9;
  border: 1px solid #0ea5e9;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.verify-btn:hover {
  background: rgba(14, 165, 233, 0.3);
}

/* ----------- HEADER BUTTONS ----------- */
.header-buttons {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
}
.settings-toggle, .account-toggle {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.8);
  width: 44px;
  height: 44px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}
.settings-toggle:hover, .account-toggle:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
}

/* ----------- SETTINGS MODAL ----------- */
.settings-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}
.settings-modal.active {
  display: flex;
}
.settings-panel {
  background: #1a2c38;
  border-radius: 16px;
  padding: 28px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.1);
  max-height: 80vh;
  overflow-y: auto;
}
.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}
.settings-header h2 {
  margin: 0;
  font-size: 20px;
  font-weight: 700;
  color: #ffffff;
}
.close-settings {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  color: rgba(255, 255, 255, 0.8);
  font-size: 24px;
  cursor: pointer;
  padding: 5px;
  width: 36px;
  height: 36px;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 400;
  transition: all 0.2s ease;
}
.close-settings:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
}
.settings-section {
  margin-bottom: 24px;
}
.settings-section h3 {
  font-size: 14px;
  margin: 0 0 12px 0;
  color: rgba(255, 255, 255, 0.9);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 700;
}
.color-input-group {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}
.color-input-group label {
  flex: 1;
  margin: 0;
  color: rgba(255, 255, 255, 0.8);
}
.color-input-group input[type="color"] {
  width: 60px;
  height: 36px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  cursor: pointer;
  padding: 2px;
  background: rgba(255, 255, 255, 0.05);
  transition: all 0.2s ease;
}
.color-input-group input[type="color"]:hover {
  border-color: rgba(255, 255, 255, 0.3);
}
.slider-group {
  margin-bottom: 10px;
}
.slider-group label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}
.slider-group input[type="range"] {
  width: 100%;
  margin: 0;
  padding: 0;
}
.balance-input-group {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}
.balance-input-group input {
  flex: 1;
}
.balance-input-group button {
  flex: 0 0 auto;
  width: auto;
  padding: 10px 16px;
}

/* ----------- ACCOUNT CENTER MODAL ----------- */
.account-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}
.account-modal.active {
  display: flex;
}
.account-panel {
  background: #1a2c38;
  border-radius: 16px;
  padding: 28px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.1);
  max-height: 85vh;
  overflow-y: auto;
}
.account-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}
.account-header h2 {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
  color: #ffffff;
}
.close-account {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  color: rgba(255, 255, 255, 0.8);
  font-size: 24px;
  cursor: pointer;
  padding: 5px;
  width: 36px;
  height: 36px;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 400;
  transition: all 0.2s ease;
}
.close-account:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
}
.account-section {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  border: 1px solid rgba(255, 255, 255, 0.08);
}
.account-section h3 {
  font-size: 16px;
  margin: 0 0 16px 0;
  color: #ffffff;
  font-weight: 700;
}
.account-info-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}
.account-info-row:last-child {
  border-bottom: none;
}
.account-info-label {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
}
.account-info-value {
  font-size: 14px;
  color: #ffffff;
  font-weight: 600;
}
.account-info-value.highlight {
  color: #4ade80;
  font-size: 18px;
}
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 12px;
}
.stat-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.1);
}
.stat-label {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.6);
  margin-bottom: 6px;
  font-weight: 500;
}
.stat-value {
  font-size: 18px;
  color: #ffffff;
  font-weight: 700;
}
.transaction-list {
  max-height: 200px;
  overflow-y: auto;
}
.transaction-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}
.transaction-item:last-child {
  border-bottom: none;
}
.transaction-type {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
}
.transaction-amount {
  font-size: 14px;
  font-weight: 600;
}
.transaction-amount.positive {
  color: #4ade80;
}
.transaction-amount.negative {
  color: #ef4444;
}
.transaction-time {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  margin-top: 2px;
}
.action-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 16px;
}
.action-buttons > :nth-child(5) {
  grid-column: span 2;
}
.action-btn {
  padding: 12px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.08);
  color: #ffffff;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.2s ease;
  text-align: center;
  width: 100%;
  margin: 0;
}
.action-btn:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
}
.action-btn.primary {
  background: #0ea5e9;
  border-color: #0ea5e9;
}
.action-btn.primary:hover {
  background: #0284c7;
  border-color: #0284c7;
}

/* ----------- BET MULTIPLIER BUTTONS ----------- */
.bet-multipliers {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}
.bet-mult-btn {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
  color: rgba(255, 255, 255, 0.8);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.2s ease;
}
.bet-mult-btn:hover {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.2);
}

/* ----------- WIN & LOSS ANIMATIONS ----------- */
.flying-coin {
  position: fixed;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  color: #ffffff;
  pointer-events: none;
  z-index: 9999;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  animation: coinFly 1.5s ease-out forwards;
}

.flying-coin.gold {
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  border: 2px solid rgba(251, 191, 36, 0.6);
}

.flying-coin.silver {
  background: linear-gradient(135deg, #d1d5db, #9ca3af);
  border: 2px solid rgba(156, 163, 175, 0.6);
}

@keyframes coinFly {
  0% {
    transform: translate(0, 0) rotate(0deg) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0.5);
    opacity: 0;
  }
}

.smoke-puff {
  position: absolute;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(150, 150, 150, 0.6), transparent);
  pointer-events: none;
  z-index: 100;
  animation: smokePuff 0.8s ease-out forwards;
}

@keyframes smokePuff {
  0% {
    transform: scale(0.3);
    opacity: 0.8;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

.coin.hidden {
  opacity: 0;
  transform: scale(0);
}

</style>
</head>

<body>
<svg class="background-cityscape" viewBox="0 0 1200 400" preserveAspectRatio="xMidYMax slice">
  <defs>
    <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0f1923;stop-opacity:0" />
      <stop offset="100%" style="stop-color:#1a2c38;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Buildings silhouettes -->
  <rect x="0" y="200" width="100" height="200" fill="#0a1218" />
  <rect x="100" y="150" width="120" height="250" fill="#08101a" />
  <rect x="220" y="180" width="80" height="220" fill="#0a1218" />
  <rect x="300" y="120" width="100" height="280" fill="#08101a" />
  <rect x="400" y="170" width="90" height="230" fill="#0a1218" />
  <rect x="490" y="100" width="110" height="300" fill="#08101a" />
  <rect x="600" y="140" width="95" height="260" fill="#0a1218" />
  <rect x="695" y="190" width="85" height="210" fill="#08101a" />
  <rect x="780" y="130" width="100" height="270" fill="#0a1218" />
  <rect x="880" y="160" width="90" height="240" fill="#08101a" />
  <rect x="970" y="110" width="105" height="290" fill="#0a1218" />
  <rect x="1075" y="180" width="125" height="220" fill="#08101a" />
  
  <!-- Windows (small rectangles) -->
  <rect x="110" y="170" width="8" height="10" fill="#fbbf24" opacity="0.3" />
  <rect x="125" y="170" width="8" height="10" fill="#fbbf24" opacity="0.5" />
  <rect x="140" y="170" width="8" height="10" fill="#fbbf24" opacity="0.3" />
  <rect x="110" y="190" width="8" height="10" fill="#fbbf24" opacity="0.4" />
  <rect x="140" y="190" width="8" height="10" fill="#fbbf24" opacity="0.2" />
  
  <rect x="320" y="140" width="8" height="10" fill="#fbbf24" opacity="0.4" />
  <rect x="335" y="140" width="8" height="10" fill="#fbbf24" opacity="0.6" />
  <rect x="350" y="140" width="8" height="10" fill="#fbbf24" opacity="0.3" />
  <rect x="320" y="160" width="8" height="10" fill="#fbbf24" opacity="0.5" />
  <rect x="350" y="160" width="8" height="10" fill="#fbbf24" opacity="0.4" />
  
  <rect x="510" y="120" width="8" height="10" fill="#fbbf24" opacity="0.5" />
  <rect x="525" y="120" width="8" height="10" fill="#fbbf24" opacity="0.3" />
  <rect x="540" y="120" width="8" height="10" fill="#fbbf24" opacity="0.6" />
  <rect x="510" y="140" width="8" height="10" fill="#fbbf24" opacity="0.4" />
  <rect x="540" y="140" width="8" height="10" fill="#fbbf24" opacity="0.3" />
  
  <rect x="800" y="150" width="8" height="10" fill="#fbbf24" opacity="0.4" />
  <rect x="815" y="150" width="8" height="10" fill="#fbbf24" opacity="0.5" />
  <rect x="830" y="150" width="8" height="10" fill="#fbbf24" opacity="0.3" />
  
  <rect x="990" y="130" width="8" height="10" fill="#fbbf24" opacity="0.5" />
  <rect x="1005" y="130" width="8" height="10" fill="#fbbf24" opacity="0.4" />
  <rect x="1020" y="130" width="8" height="10" fill="#fbbf24" opacity="0.6" />
  
  <!-- Overlay gradient -->
  <rect x="0" y="0" width="1200" height="400" fill="url(#skyGradient)" />
</svg>

<div class="game-container">
  <div class="header-buttons">
    <button class="account-toggle" id="accountToggle">üë§</button>
    <button class="settings-toggle" id="settingsToggle">‚öôÔ∏è</button>
  </div>
  <h1>Coin Clash</h1>

  <div class="balance-row">
    <span>Balance:</span>
    <span class="balance-value" id="balanceDisplay">$0.00</span>
  </div>

  <label>Bet Amount</label>
  <div class="bet-multipliers">
    <button class="bet-mult-btn" id="halfBet">¬Ω Bet</button>
    <button class="bet-mult-btn" id="doubleBet">2√ó Bet</button>
  </div>
  <input type="number" id="betAmount" value="10" min="0.10" max="20000" step="0.01" />

  <div class="multiplier-row">
    <div class="multiplier-label">Target Multiplier (Auto-picked: <span id="multDisplay">1.96x</span>)</div>
  </div>

  <div class="choice-row">
    <div class="choice-label">Pick Your Side</div>
    <div class="choice-buttons">
      <button class="choice-btn active" data-choice="heads">Heads</button>
      <button class="choice-btn" data-choice="tails">Tails</button>
    </div>
  </div>

  <button id="betButton">Bet</button>

  <div class="coin-area">
    <div class="motion-trail" id="trail"></div>
    <div class="hand" id="hand">üëÜ</div>
    <div class="coin" id="coin">?</div>
    <div class="coin-label" id="coinLabel">Deposit funds to start playing...</div>
  </div>

  <div class="result" id="resultText"></div>
  <div class="error" id="errorText"></div>

  <div class="info-line">
    Dynamic Win-98% RTP
  </div>

  <div class="provably-fair-section" id="fairSection" style="display: none;">
    <h3>üîê Provably Fair Verification</h3>
    <div class="fair-info-row">
      <span class="fair-info-label">Server Seed Hash:</span>
      <span class="fair-info-value" id="fairServerHash">-</span>
    </div>
    <div class="fair-info-row">
      <span class="fair-info-label">Client Seed:</span>
      <span class="fair-info-value" id="fairClientSeed">-</span>
    </div>
    <div class="fair-info-row">
      <span class="fair-info-label">Nonce:</span>
      <span class="fair-info-value" id="fairNonce">-</span>
    </div>
    <div class="fair-info-row">
      <span class="fair-info-label">Roll Result:</span>
      <span class="fair-info-value" id="fairRoll">-</span>
    </div>
    <div class="fair-info-row">
      <span class="fair-info-label">Win Threshold:</span>
      <span class="fair-info-value" id="fairThreshold">-</span>
    </div>
    <button class="verify-btn" id="verifyBtn">Verify Result Independently</button>
  </div>

  <div class="fairness" id="fairnessInfo"></div>
</div>

<div class="account-modal" id="accountModal">
  <div class="account-panel">
    <div class="account-header">
      <h2>Account Center</h2>
      <button class="close-account" id="closeAccount">√ó</button>
    </div>

    <div class="account-section">
      <h3>Account Overview</h3>
      <div class="account-info-row">
        <span class="account-info-label">Current Balance</span>
        <span class="account-info-value highlight" id="accountBalance">$0.00</span>
      </div>
      <div class="account-info-row">
        <span class="account-info-label">Account ID</span>
        <span class="account-info-value" id="accountId">Guest</span>
      </div>
      <div class="account-info-row">
        <span class="account-info-label">Member Since</span>
        <span class="account-info-value" id="memberSince">Today</span>
      </div>
    </div>

    <div class="account-section">
      <h3>Statistics</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Bets</div>
          <div class="stat-value" id="totalBets">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Wagered</div>
          <div class="stat-value" id="totalWagered">$0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Win Rate</div>
          <div class="stat-value" id="winRate">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Net Profit</div>
          <div class="stat-value" id="netProfit">$0.00</div>
        </div>
      </div>
    </div>

    <div class="account-section">
      <h3>Recent Transactions</h3>
      <div class="transaction-list" id="transactionList">
        <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.5);">
          No transactions yet
        </div>
      </div>
    </div>

    <div class="account-section">
      <h3>Quick Actions</h3>
      <div class="action-buttons">
        <button class="action-btn primary" id="quickDeposit">üí∞ Deposit</button>
        <button class="action-btn primary" id="quickWithdraw">üí∏ Withdraw</button>
        <button class="action-btn" id="viewHistory">üìä History</button>
        <button class="action-btn" id="resetStats">üîÑ Reset Stats</button>
        <button class="action-btn" id="exportData">üì• Export</button>
      </div>
    </div>
  </div>
</div>

<div class="settings-modal" id="settingsModal">
  <div class="settings-panel">
    <div class="settings-header">
      <h2>Settings</h2>
      <button class="close-settings" id="closeSettings">√ó</button>
    </div>

    <div class="settings-section">
      <h3>Colors</h3>
      <div class="color-input-group">
        <label>Background</label>
        <input type="color" id="colorBg" value="#0f1923" />
      </div>
      <div class="color-input-group">
        <label>Panel Background</label>
        <input type="color" id="colorPanel" value="#1a2c38" />
      </div>
      <div class="color-input-group">
        <label>Text</label>
        <input type="color" id="colorText" value="#ffffff" />
      </div>
      <div class="color-input-group">
        <label>Accent (Buttons)</label>
        <input type="color" id="colorAccent" value="#0ea5e9" />
      </div>
    </div>

    <div class="settings-section">
      <h3>Audio</h3>
      <div class="slider-group">
        <label>
          <span>Sound Effects Volume</span>
          <span id="volumeDisplay">100%</span>
        </label>
        <input type="range" id="volumeSlider" min="0" max="100" value="100" />
      </div>
      <div class="slider-group">
        <label>
          <span>Background Music Volume</span>
          <span id="musicVolumeDisplay">100%</span>
        </label>
        <input type="range" id="musicVolumeSlider" min="0" max="100" value="100" />
      </div>
      <div class="color-input-group" style="margin-top: 10px;">
        <label>Background Music</label>
        <button id="musicToggle" style="width: auto; padding: 8px 16px; margin: 0; font-size: 14px;">ON</button>
      </div>
    </div>

    <div class="settings-section">
      <h3>Balance</h3>
      <div class="balance-input-group">
        <input type="number" id="depositAmount" placeholder="Amount" min="0.10" step="0.01" />
        <button id="depositBtn">Deposit</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const DEBUG = false;
  const RTP = 0.98;
  const MIN_BET = 0.10;
  const MAX_BET = 20000.00;
  const MIN_MULTIPLIER = 1.96;
  const MAX_MULTIPLIER = 10.00;
  const API_URL = "/.netlify/functions/play";
  const RAPID_BET_THRESHOLD = 500;
  
  let lastBetTime = 0;
  let isProcessingBet = false;

  let balance = 0.00;
  let selectedMultiplier = 1.96;
  let playerChoice = "heads";
  
  let accountStats = {
    totalBets: 0,
    totalWagered: 0,
    totalWins: 0,
    netProfit: 0,
    transactions: [],
    memberSince: new Date().toLocaleDateString(),
    gameHistory: []
  };
  
  const API_HOOKS = {
    onDeposit: null,
    onWithdraw: null,
    onBetPlaced: null,
    onBetResult: null,
    onBalanceUpdate: null
  };

  const balanceDisplay = document.getElementById("balanceDisplay");
  const betAmount = document.getElementById("betAmount");
  const betButton = document.getElementById("betButton");
  const resultText = document.getElementById("resultText");
  const errorText = document.getElementById("errorText");
  const coin = document.getElementById("coin");
  const coinLabel = document.getElementById("coinLabel");
  const fairnessInfo = document.getElementById("fairnessInfo");
  const trail = document.getElementById("trail");
  const hand = document.getElementById("hand");
  const multDisplay = document.getElementById("multDisplay");
  
  const fairSection = document.getElementById("fairSection");
  const fairServerHash = document.getElementById("fairServerHash");
  const fairClientSeed = document.getElementById("fairClientSeed");
  const fairNonce = document.getElementById("fairNonce");
  const fairRoll = document.getElementById("fairRoll");
  const fairThreshold = document.getElementById("fairThreshold");
  const verifyBtn = document.getElementById("verifyBtn");
  
  let currentGameData = null;
  
  const accountToggle = document.getElementById("accountToggle");
  const accountModal = document.getElementById("accountModal");
  const closeAccount = document.getElementById("closeAccount");
  const accountBalance = document.getElementById("accountBalance");
  const totalBets = document.getElementById("totalBets");
  const totalWagered = document.getElementById("totalWagered");
  const winRate = document.getElementById("winRate");
  const netProfit = document.getElementById("netProfit");
  const transactionList = document.getElementById("transactionList");
  const memberSince = document.getElementById("memberSince");
  const quickDeposit = document.getElementById("quickDeposit");
  const quickWithdraw = document.getElementById("quickWithdraw");
  const viewHistory = document.getElementById("viewHistory");
  const resetStats = document.getElementById("resetStats");
  const exportData = document.getElementById("exportData");

  (function checkIntegrity() {
    if (typeof playRound !== 'function' || typeof fetch !== 'function') {
      console.warn('Tampering detected: Core game functions may be compromised');
    }
  })();

  function createCoinFlickSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const now = audioContext.currentTime;
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      const filter = audioContext.createBiquadFilter();
      
      oscillator.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(900, now);
      oscillator.frequency.exponentialRampToValueAtTime(2200, now + 0.04);
      oscillator.frequency.exponentialRampToValueAtTime(400, now + 0.18);
      
      filter.type = 'bandpass';
      filter.frequency.setValueAtTime(1600, now);
      filter.Q.value = 6;
      
      gainNode.gain.setValueAtTime(0.45 * masterVolume, now);
      gainNode.gain.exponentialRampToValueAtTime(0.18 * masterVolume, now + 0.06);
      gainNode.gain.exponentialRampToValueAtTime(0.01 * masterVolume, now + 0.22);
      
      oscillator.start(now);
      oscillator.stop(now + 0.22);
    } catch (e) {
      console.warn('Audio playback failed:', e);
    }
  }

  function createCaChingSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const now = audioContext.currentTime;
      
      const osc1 = audioContext.createOscillator();
      const osc2 = audioContext.createOscillator();
      const osc3 = audioContext.createOscillator();
      const gain1 = audioContext.createGain();
      const gain2 = audioContext.createGain();
      const gain3 = audioContext.createGain();
      const mainGain = audioContext.createGain();
      
      osc1.connect(gain1);
      osc2.connect(gain2);
      osc3.connect(gain3);
      gain1.connect(mainGain);
      gain2.connect(mainGain);
      gain3.connect(mainGain);
      mainGain.connect(audioContext.destination);
      
      osc1.type = 'triangle';
      osc2.type = 'sine';
      osc3.type = 'sine';
      
      osc1.frequency.setValueAtTime(1047, now);
      osc1.frequency.exponentialRampToValueAtTime(1319, now + 0.06);
      osc1.frequency.exponentialRampToValueAtTime(1568, now + 0.12);
      
      osc2.frequency.setValueAtTime(1047 * 2, now);
      osc2.frequency.exponentialRampToValueAtTime(1319 * 2, now + 0.06);
      osc2.frequency.exponentialRampToValueAtTime(1568 * 2, now + 0.12);
      
      osc3.frequency.setValueAtTime(1047 * 0.5, now);
      osc3.frequency.exponentialRampToValueAtTime(1319 * 0.5, now + 0.06);
      osc3.frequency.exponentialRampToValueAtTime(1568 * 0.5, now + 0.12);
      
      gain1.gain.setValueAtTime(0.35, now);
      gain1.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
      
      gain2.gain.setValueAtTime(0.18, now);
      gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
      
      gain3.gain.setValueAtTime(0.15, now);
      gain3.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
      
      mainGain.gain.setValueAtTime(0.6 * masterVolume, now);
      
      osc1.start(now);
      osc2.start(now);
      osc3.start(now);
      osc1.stop(now + 0.5);
      osc2.stop(now + 0.5);
      osc3.stop(now + 0.5);
    } catch (e) {
      console.warn('Audio playback failed:', e);
    }
  }

  function createWompSound() {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const now = audioContext.currentTime;
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      const filter = audioContext.createBiquadFilter();
      
      oscillator.connect(filter);
      filter.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.type = 'sawtooth';
      
      oscillator.frequency.setValueAtTime(220, now);
      oscillator.frequency.exponentialRampToValueAtTime(45, now + 0.6);
      
      filter.type = 'lowpass';
      filter.frequency.setValueAtTime(800, now);
      filter.frequency.exponentialRampToValueAtTime(100, now + 0.6);
      filter.Q.value = 3;
      
      gainNode.gain.setValueAtTime(0.35 * masterVolume, now);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.6);
      
      oscillator.start(now);
      oscillator.stop(now + 0.6);
    } catch (e) {
      console.warn('Audio playback failed:', e);
    }
  }

  function createBackgroundMusic() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
    const chordNotes = [
      [262, 330, 392],
      [294, 370, 440],
      [247, 311, 370],
      [262, 330, 392]
    ];
    
    let currentChord = 0;
    const chordDuration = 4;
    
    function playChord() {
      if (!isMusicPlaying || !musicEnabled) return;
      
      const now = audioContext.currentTime;
      const notes = chordNotes[currentChord % chordNotes.length];
      
      notes.forEach((freq, idx) => {
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        const filter = audioContext.createBiquadFilter();
        
        osc.connect(filter);
        filter.connect(gain);
        gain.connect(audioContext.destination);
        
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, now);
        
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(1200, now);
        filter.Q.value = 1;
        
        const baseGain = 0.04 * musicVolume;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(baseGain, now + 0.5);
        gain.gain.setValueAtTime(baseGain, now + chordDuration - 0.5);
        gain.gain.linearRampToValueAtTime(0, now + chordDuration);
        
        osc.start(now);
        osc.stop(now + chordDuration);
      });
      
      currentChord++;
      setTimeout(playChord, chordDuration * 1000);
    }
    
    isMusicPlaying = true;
    playChord();
  }

  function stopBackgroundMusic() {
    isMusicPlaying = false;
  }

  function createSuspenseMusic() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const now = audioContext.currentTime;
    
    const duration = 1.2;
    
    const osc1 = audioContext.createOscillator();
    const osc2 = audioContext.createOscillator();
    const gain1 = audioContext.createGain();
    const gain2 = audioContext.createGain();
    const mainGain = audioContext.createGain();
    
    osc1.connect(gain1);
    osc2.connect(gain2);
    gain1.connect(mainGain);
    gain2.connect(mainGain);
    mainGain.connect(audioContext.destination);
    
    osc1.type = 'sine';
    osc2.type = 'triangle';
    
    osc1.frequency.setValueAtTime(200, now);
    osc1.frequency.linearRampToValueAtTime(400, now + duration);
    
    osc2.frequency.setValueAtTime(300, now);
    osc2.frequency.linearRampToValueAtTime(600, now + duration);
    
    gain1.gain.setValueAtTime(0.15 * masterVolume, now);
    gain1.gain.linearRampToValueAtTime(0.25 * masterVolume, now + duration * 0.7);
    gain1.gain.exponentialRampToValueAtTime(0.01, now + duration);
    
    gain2.gain.setValueAtTime(0.1 * masterVolume, now);
    gain2.gain.linearRampToValueAtTime(0.2 * masterVolume, now + duration * 0.7);
    gain2.gain.exponentialRampToValueAtTime(0.01, now + duration);
    
    osc1.start(now);
    osc2.start(now);
    osc1.stop(now + duration);
    osc2.stop(now + duration);
  }

  function createCheerfulMusic() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const now = audioContext.currentTime;
    
    const melody = [523, 587, 659, 784, 880];
    
    melody.forEach((freq, idx) => {
      const startTime = now + (idx * 0.12);
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      
      osc.connect(gain);
      gain.connect(audioContext.destination);
      
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, startTime);
      
      gain.gain.setValueAtTime(0.25 * masterVolume, startTime);
      gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
      
      osc.start(startTime);
      osc.stop(startTime + 0.3);
    });
  }

  function createSadMusic() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const now = audioContext.currentTime;
    
    const melody = [440, 392, 349, 330, 294];
    
    melody.forEach((freq, idx) => {
      const startTime = now + (idx * 0.15);
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      
      osc.connect(gain);
      gain.connect(audioContext.destination);
      
      osc.type = 'triangle';
      osc.frequency.setValueAtTime(freq, startTime);
      
      gain.gain.setValueAtTime(0.2 * masterVolume, startTime);
      gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.4);
      
      osc.start(startTime);
      osc.stop(startTime + 0.4);
    });
  }

  function spawnFlyingCoins(centerX, centerY, count = 15) {
    for (let i = 0; i < count; i++) {
      const coin = document.createElement('div');
      coin.className = `flying-coin ${i % 2 === 0 ? 'gold' : 'silver'}`;
      coin.textContent = i % 2 === 0 ? 'üí∞' : 'ü™ô';
      
      const angle = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.5;
      const distance = 200 + Math.random() * 400;
      const tx = Math.cos(angle) * distance;
      const ty = Math.sin(angle) * distance - 100;
      
      coin.style.left = `${centerX}px`;
      coin.style.top = `${centerY}px`;
      coin.style.setProperty('--tx', `${tx}px`);
      coin.style.setProperty('--ty', `${ty}px`);
      
      document.body.appendChild(coin);
      
      setTimeout(() => {
        coin.remove();
      }, 1500);
    }
  }

  function createSmokePuff(centerX, centerY) {
    const smoke = document.createElement('div');
    smoke.className = 'smoke-puff';
    smoke.style.left = `${centerX - 60}px`;
    smoke.style.top = `${centerY - 60}px`;
    
    const coinArea = document.querySelector('.coin-area');
    coinArea.appendChild(smoke);
    
    setTimeout(() => {
      smoke.remove();
    }, 800);
  }


  let masterVolume = 1.0;
  let musicVolume = 1.0;
  let backgroundMusic = null;
  let isMusicPlaying = false;
  let musicEnabled = true;

  // Settings management
  const settingsToggle = document.getElementById("settingsToggle");
  const settingsModal = document.getElementById("settingsModal");
  const closeSettings = document.getElementById("closeSettings");
  const colorBg = document.getElementById("colorBg");
  const colorPanel = document.getElementById("colorPanel");
  const colorText = document.getElementById("colorText");
  const colorAccent = document.getElementById("colorAccent");
  const volumeSlider = document.getElementById("volumeSlider");
  const volumeDisplay = document.getElementById("volumeDisplay");
  const musicVolumeSlider = document.getElementById("musicVolumeSlider");
  const musicVolumeDisplay = document.getElementById("musicVolumeDisplay");
  const musicToggle = document.getElementById("musicToggle");
  const depositAmount = document.getElementById("depositAmount");
  const depositBtn = document.getElementById("depositBtn");
  const halfBet = document.getElementById("halfBet");
  const doubleBet = document.getElementById("doubleBet");

  function loadSettings() {
    const saved = localStorage.getItem("coinClashSettings");
    if (saved) {
      const settings = JSON.parse(saved);
      if (settings.colorBg) {
        colorBg.value = settings.colorBg;
        document.body.style.background = settings.colorBg;
      }
      if (settings.colorPanel) {
        colorPanel.value = settings.colorPanel;
        const containers = document.querySelectorAll(".game-container, .settings-panel, .account-panel");
        containers.forEach(container => {
          container.style.background = settings.colorPanel;
        });
      }
      if (settings.colorText) {
        colorText.value = settings.colorText;
        document.body.style.color = settings.colorText;
      }
      if (settings.colorAccent) {
        colorAccent.value = settings.colorAccent;
        applyAccentColor(settings.colorAccent);
      }
      if (settings.volume !== undefined) {
        masterVolume = settings.volume / 100;
        volumeSlider.value = settings.volume;
        volumeDisplay.textContent = settings.volume + "%";
      }
      if (settings.musicVolume !== undefined) {
        musicVolume = settings.musicVolume / 100;
        musicVolumeSlider.value = settings.musicVolume;
        musicVolumeDisplay.textContent = settings.musicVolume + "%";
      }
      if (settings.musicEnabled !== undefined) {
        musicEnabled = settings.musicEnabled;
        musicToggle.textContent = musicEnabled ? "ON" : "OFF";
      }
      if (settings.balance !== undefined) {
        balance = settings.balance;
        updateBal();
      }
      if (settings.accountStats) {
        accountStats = settings.accountStats;
        updateAccountStats();
      }
    } else {
      applyAccentColor('#0ea5e9');
    }
  }

  function saveSettings() {
    const settings = {
      colorBg: colorBg.value,
      colorPanel: colorPanel.value,
      colorText: colorText.value,
      colorAccent: colorAccent.value,
      volume: parseInt(volumeSlider.value),
      musicVolume: parseInt(musicVolumeSlider.value),
      musicEnabled: musicEnabled,
      balance: balance,
      accountStats: accountStats
    };
    localStorage.setItem("coinClashSettings", JSON.stringify(settings));
  }

  function applyAccentColor(color) {
    document.documentElement.style.setProperty("--accent-color", color);
    const style = document.createElement("style");
    style.id = "dynamic-accent-style";
    style.textContent = `
      button:not(.close-settings):not(.bet-mult-btn):not(.choice-btn) { 
        background: ${color} !important; 
      }
      button:not(.close-settings):not(.bet-mult-btn):not(.choice-btn):hover:not(:disabled) {
        opacity: 0.9 !important;
      }
      .choice-btn.active { 
        background: ${color} !important; 
        border-color: ${color} !important; 
      }
    `;
    const oldStyle = document.getElementById("dynamic-accent-style");
    if (oldStyle) oldStyle.remove();
    document.head.appendChild(style);
  }

  settingsToggle.addEventListener("click", () => {
    settingsModal.classList.add("active");
  });

  closeSettings.addEventListener("click", () => {
    settingsModal.classList.remove("active");
  });

  settingsModal.addEventListener("click", (e) => {
    if (e.target === settingsModal) {
      settingsModal.classList.remove("active");
    }
  });

  colorBg.addEventListener("input", (e) => {
    document.body.style.background = e.target.value;
    saveSettings();
  });

  colorPanel.addEventListener("input", (e) => {
    const containers = document.querySelectorAll(".game-container, .settings-panel");
    containers.forEach(container => {
      container.style.background = e.target.value;
    });
    saveSettings();
  });

  colorText.addEventListener("input", (e) => {
    document.body.style.color = e.target.value;
    saveSettings();
  });

  colorAccent.addEventListener("input", (e) => {
    applyAccentColor(e.target.value);
    saveSettings();
  });

  volumeSlider.addEventListener("input", (e) => {
    const vol = parseInt(e.target.value);
    masterVolume = vol / 100;
    volumeDisplay.textContent = vol + "%";
    saveSettings();
  });

  musicVolumeSlider.addEventListener("input", (e) => {
    const vol = parseInt(e.target.value);
    musicVolume = vol / 100;
    musicVolumeDisplay.textContent = vol + "%";
    saveSettings();
  });

  musicToggle.addEventListener("click", () => {
    musicEnabled = !musicEnabled;
    musicToggle.textContent = musicEnabled ? "ON" : "OFF";
    
    if (musicEnabled) {
      createBackgroundMusic();
    } else {
      stopBackgroundMusic();
    }
    
    saveSettings();
  });

  depositBtn.addEventListener("click", () => {
    const amount = parseFloat(depositAmount.value);
    if (isNaN(amount)) {
      alert("Please enter a valid deposit amount.");
      return;
    }
    if (amount < 1) {
      alert("Minimum deposit is $1.00");
      return;
    }
    if (amount > 20000) {
      alert("Maximum deposit is $20,000.00");
      return;
    }
    balance = Math.round((balance + amount) * 100) / 100;
    addTransaction("Deposit", amount);
    updateBal();
    depositAmount.value = "";
    saveSettings();
  });

  halfBet.addEventListener("click", () => {
    const current = parseFloat(betAmount.value) || 0;
    const newBet = Math.max(0.1, current / 2);
    betAmount.value = newBet.toFixed(2);
  });

  doubleBet.addEventListener("click", () => {
    const current = parseFloat(betAmount.value) || 0;
    const newBet = Math.min(20000, current * 2);
    betAmount.value = newBet.toFixed(2);
  });

  loadSettings();
  
  if (musicEnabled) {
    createBackgroundMusic();
  }
  
  function updateAccountStats() {
    accountBalance.textContent = formatMoney(balance);
    totalBets.textContent = formatNumber(accountStats.totalBets);
    totalWagered.textContent = formatMoney(accountStats.totalWagered);
    
    const winRatePercent = accountStats.totalBets > 0 
      ? ((accountStats.totalWins / accountStats.totalBets) * 100).toFixed(1)
      : "0.0";
    winRate.textContent = winRatePercent + "%";
    
    netProfit.textContent = formatMoney(accountStats.netProfit);
    memberSince.textContent = accountStats.memberSince;
    
    if (accountStats.transactions.length > 0) {
      transactionList.innerHTML = accountStats.transactions
        .slice(-10)
        .reverse()
        .map(tx => `
          <div class="transaction-item">
            <div>
              <div class="transaction-type">${tx.type}</div>
              <div class="transaction-time">${tx.time}</div>
            </div>
            <div class="transaction-amount ${tx.amount >= 0 ? 'positive' : 'negative'}">
              ${tx.amount >= 0 ? '+' : ''}${formatMoney(Math.abs(tx.amount))}
            </div>
          </div>
        `).join('');
    } else {
      transactionList.innerHTML = '<div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.5);">No transactions yet</div>';
    }
  }
  
  function addTransaction(type, amount) {
    const transaction = {
      type,
      amount,
      time: new Date().toLocaleTimeString(),
      timestamp: Date.now()
    };
    
    accountStats.transactions.push(transaction);
    
    if (accountStats.transactions.length > 50) {
      accountStats.transactions = accountStats.transactions.slice(-50);
    }
    updateAccountStats();
    
    if (type.startsWith('Win') || type.startsWith('Loss')) {
      if (typeof API_HOOKS.onBetResult === 'function') {
        try {
          API_HOOKS.onBetResult({
            type: type.startsWith('Win') ? 'win' : 'loss',
            amount: Math.abs(amount),
            timestamp: transaction.timestamp
          });
        } catch (e) {
          console.warn('Bet result hook failed:', e);
        }
      }
    } else if (type === 'Deposit' && typeof API_HOOKS.onDeposit === 'function') {
      try {
        API_HOOKS.onDeposit(amount);
      } catch (e) {
        console.warn('Deposit hook failed:', e);
      }
    } else if (type === 'Withdrawal' && typeof API_HOOKS.onWithdraw === 'function') {
      try {
        API_HOOKS.onWithdraw(Math.abs(amount));
      } catch (e) {
        console.warn('Withdraw hook failed:', e);
      }
    }
  }
  
  accountToggle.addEventListener("click", () => {
    accountModal.classList.add("active");
    updateAccountStats();
  });
  
  closeAccount.addEventListener("click", () => {
    accountModal.classList.remove("active");
  });
  
  accountModal.addEventListener("click", (e) => {
    if (e.target === accountModal) {
      accountModal.classList.remove("active");
    }
  });
  
  quickDeposit.addEventListener("click", () => {
    accountModal.classList.remove("active");
    settingsModal.classList.add("active");
  });
  
  quickWithdraw.addEventListener("click", () => {
    const amount = parseFloat(prompt("Enter withdrawal amount:"));
    if (isNaN(amount)) {
      alert("Please enter a valid withdrawal amount.");
      return;
    }
    if (amount <= 0) {
      alert("Withdrawal amount must be greater than $0.00");
      return;
    }
    if (amount > balance) {
      alert("Insufficient balance for this withdrawal.");
      return;
    }
    balance = Math.round((balance - amount) * 100) / 100;
    addTransaction("Withdrawal", -amount);
    updateBal();
    saveSettings();
    alert(`Successfully withdrew ${formatMoney(amount)}`);
  });
  
  viewHistory.addEventListener("click", () => {
    if (accountStats.gameHistory && accountStats.gameHistory.length > 0) {
      const historyText = accountStats.gameHistory
        .slice(-20)
        .reverse()
        .map((game, idx) => {
          const date = new Date(game.timestamp).toLocaleString();
          return `${idx + 1}. ${date}\n   Bet: $${game.bet.toFixed(2)} | ${game.multiplier}x | ${game.playerChoice}\n   Result: ${game.coinSide} - ${game.didWin ? 'WIN' : 'LOSS'} | ${game.didWin ? '+' : '-'}$${Math.abs(game.payout - game.bet).toFixed(2)}`;
        })
        .join('\n\n');
      
      alert(`Recent Game History (Last 20):\n\n${historyText}`);
    } else {
      alert("No game history available yet. Play some rounds first!");
    }
  });
  
  resetStats.addEventListener("click", () => {
    if (confirm("Are you sure you want to reset all statistics? This cannot be undone.")) {
      accountStats = {
        totalBets: 0,
        totalWagered: 0,
        totalWins: 0,
        netProfit: 0,
        transactions: [],
        memberSince: accountStats.memberSince
      };
      updateAccountStats();
      saveSettings();
    }
  });
  
  exportData.addEventListener("click", () => {
    const data = {
      balance,
      accountStats,
      gameHistory: accountStats.gameHistory || [],
      exportDate: new Date().toISOString(),
      version: '1.0'
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `coinclash-data-${Date.now()}.json`;
    a.click();
    URL.revokeObjectURL(url);
  });

  const choiceButtons = document.querySelectorAll(".choice-btn");
  choiceButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      playerChoice = btn.dataset.choice;
      choiceButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
    });
  });

  function randomMultiplier() {
    const min = 1.96;
    const max = 10.00;
    const random = Math.random();
    const mult = min + (max - min) * Math.pow(random, 1.5);
    return Math.round(mult * 100) / 100;
  }

  function formatMoney(v) { 
    return "$" + v.toLocaleString('en-US', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }
  
  function formatNumber(v) {
    return v.toLocaleString('en-US');
  }
  
  function updateBal() { 
    balanceDisplay.textContent = formatMoney(balance);
    if (accountBalance) {
      accountBalance.textContent = formatMoney(balance);
    }
    if (balance > 0 && coinLabel.textContent === "Deposit funds to start playing...") {
      coinLabel.textContent = "Waiting for bet...";
    } else if (balance === 0) {
      coinLabel.textContent = "Deposit funds to start playing...";
    }
    
    if (typeof API_HOOKS.onBalanceUpdate === 'function') {
      try {
        API_HOOKS.onBalanceUpdate(balance);
      } catch (e) {
        console.warn('Balance update hook failed:', e);
      }
    }
  }
  updateBal();

  function clientSeed() {
    return Date.now() + "-" + Math.floor(Math.random() * 1e6);
  }

  function playTrail() {
    trail.classList.remove("active");
    void trail.offsetWidth;
    trail.classList.add("active");
  }

  function validateBet(bet) {
    if (balance === 0) {
      return { valid: false, error: "Please deposit between $1.00 and $20,000.00 to start playing" };
    }
    if (isNaN(bet) || bet === null || bet === undefined) {
      return { valid: false, error: "Bet must be a valid number" };
    }
    if (bet <= 0) {
      return { valid: false, error: "Bet must be greater than zero" };
    }
    if (bet < MIN_BET) {
      return { valid: false, error: `Minimum bet is $${MIN_BET.toFixed(2)}` };
    }
    if (bet > MAX_BET) {
      return { valid: false, error: `Maximum bet is $${MAX_BET.toLocaleString('en-US', {minimumFractionDigits: 2})}` };
    }
    if (bet > balance) {
      return { valid: false, error: `Insufficient balance. Available: ${formatMoney(balance)}` };
    }
    const betRounded = Math.round(bet * 100) / 100;
    if (bet !== betRounded) {
      return { valid: false, error: "Bet amount can only have 2 decimal places" };
    }
    return { valid: true };
  }

  async function playRound() {
    if (isProcessingBet) {
      errorText.textContent = "Please wait for the current bet to complete";
      return;
    }
    
    const now = Date.now();
    if (now - lastBetTime < RAPID_BET_THRESHOLD) {
      errorText.textContent = "Please wait a moment before placing another bet";
      return;
    }
    
    errorText.textContent = "";
    resultText.textContent = "";
    fairnessInfo.textContent = "";

    let bet = parseFloat(betAmount.value);
    
    const validation = validateBet(bet);
    if (!validation.valid) {
      errorText.textContent = validation.error;
      return;
    }
    
    if (selectedMultiplier < MIN_MULTIPLIER || selectedMultiplier > MAX_MULTIPLIER) {
      errorText.textContent = `Multiplier must be between ${MIN_MULTIPLIER}x and ${MAX_MULTIPLIER}x`;
      return;
    }
    
    isProcessingBet = true;
    lastBetTime = now;

    const originalBalance = balance;
    balance = Math.round((balance - bet) * 100) / 100;
    updateBal();
    saveSettings();
    
    if (typeof API_HOOKS.onBetPlaced === 'function') {
      try {
        API_HOOKS.onBetPlaced({
          bet,
          multiplier: selectedMultiplier,
          playerChoice,
          timestamp: Date.now()
        });
      } catch (e) {
        console.warn('Bet placed hook failed:', e);
      }
    }
    
    stopBackgroundMusic();
    createSuspenseMusic();
    createCoinFlickSound();
    betButton.disabled = true;

    selectedMultiplier = randomMultiplier();
    multDisplay.textContent = selectedMultiplier + "x";

    coin.classList.remove('hidden');
    coin.textContent = "";
    coin.classList.remove("tossing");
    hand.classList.remove("flicking");
    void coin.offsetWidth;
    void hand.offsetWidth;
    hand.classList.add("flicking");
    coin.classList.add("tossing");
    playTrail();

    const cSeed = clientSeed();

    try {
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          bet: bet,
          multiplier: selectedMultiplier,
          client_seed: cSeed,
          player_choice: playerChoice
        }),
        signal: AbortSignal.timeout(15000)
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ detail: 'Server error' }));
        
        if (response.status === 429) {
          throw new Error('Too many requests. Please wait a moment and try again.');
        } else if (response.status === 400) {
          throw new Error(errorData.detail || 'Invalid bet parameters');
        } else if (response.status >= 500) {
          throw new Error('Server error. Please try again in a moment.');
        } else {
          throw new Error(errorData.detail || `Server returned ${response.status}`);
        }
      }

      const data = await response.json();

      if (DEBUG) {
        console.log('Game result:', {
          bet,
          multiplier: selectedMultiplier,
          winChance: data.win_chance,
          roll: data.roll,
          didWin: data.did_win,
          payout: data.payout
        });
      }

      setTimeout(() => {
        const coinResult = data.coin_side;
        const didWin = data.did_win;
        const payout = data.payout;
        
        accountStats.totalBets += 1;
        accountStats.totalWagered += bet;
        
        const gameRecord = {
          timestamp: Date.now(),
          bet,
          multiplier: selectedMultiplier,
          playerChoice,
          coinSide: coinResult,
          didWin,
          payout: didWin && payout > 0 ? Math.round(payout * 100) / 100 : 0,
          roll: data.roll,
          winChance: data.win_chance,
          nonce: data.nonce
        };
        
        accountStats.gameHistory.push(gameRecord);
        if (accountStats.gameHistory.length > 100) {
          accountStats.gameHistory = accountStats.gameHistory.slice(-100);
        }

        if (didWin && payout > 0) {
          const actualPayout = Math.round(payout * 100) / 100;
          balance = Math.round((balance + actualPayout) * 100) / 100;
          accountStats.totalWins += 1;
          accountStats.netProfit = Math.round((accountStats.netProfit + (actualPayout - bet)) * 100) / 100;
          addTransaction(`Win - ${coinResult.toUpperCase()}`, actualPayout - bet);
          updateBal();
          saveSettings();
          
          coin.classList.remove('hidden');
          coin.textContent = coinResult === "heads" ? "H" : "T";
          coinLabel.textContent = `${coinResult.charAt(0).toUpperCase() + coinResult.slice(1)} ‚Äî You win!`;
          createCheerfulMusic();
          createCaChingSound();

          const coinRect = coin.getBoundingClientRect();
          const coinCenterX = coinRect.left + coinRect.width / 2;
          const coinCenterY = coinRect.top + coinRect.height / 2;
          spawnFlyingCoins(coinCenterX, coinCenterY, 20);

          resultText.className = "result win";
          resultText.textContent =
            `WIN! Landed ${coinResult}, you picked ${playerChoice} ‚Äî Won ${formatMoney(actualPayout)} at ${selectedMultiplier}x`;
          multDisplay.style.color = "#4ade80";
        } else {
          accountStats.netProfit = Math.round((accountStats.netProfit - bet) * 100) / 100;
          addTransaction(`Loss - ${coinResult.toUpperCase()}`, -bet);
          coin.textContent = coinResult === "heads" ? "H" : "T";
          
          const coinRect = coin.getBoundingClientRect();
          const coinCenterX = coinRect.left + coinRect.width / 2;
          const coinCenterY = coinRect.top + coinRect.height / 2;
          
          const coinArea = document.querySelector('.coin-area');
          const coinAreaRect = coinArea.getBoundingClientRect();
          const relativeCenterX = coinCenterX - coinAreaRect.left;
          const relativeCenterY = coinCenterY - coinAreaRect.top;
          
          createSmokePuff(relativeCenterX, relativeCenterY);
          
          setTimeout(() => {
            coin.classList.add('hidden');
          }, 100);
          
          coinLabel.textContent = `${coinResult.charAt(0).toUpperCase() + coinResult.slice(1)} ‚Äî You lose.`;
          createSadMusic();
          createWompSound();

          resultText.className = "result lose";
          resultText.textContent = `LOSS. Landed ${coinResult}, you picked ${playerChoice}`;
          multDisplay.style.color = "#ef4444";
        }
        
        saveSettings();

        fairnessInfo.textContent =
          `Server RNG ‚Äî roll: ${data.roll.toFixed(6)} | win_threshold: ${data.win_chance.toFixed(6)} | ` +
          `server_seed_hash: ${data.server_seed_hash.substring(0, 16)}... | nonce: ${data.nonce}`;
        
        currentGameData = {
          serverSeedHash: data.server_seed_hash,
          clientSeed: cSeed,
          nonce: data.nonce,
          roll: data.roll,
          winChance: data.win_chance,
          bet: bet,
          multiplier: selectedMultiplier,
          result: didWin ? 'win' : 'loss'
        };
        
        fairSection.style.display = 'block';
        fairServerHash.textContent = data.server_seed_hash.substring(0, 32) + '...';
        fairClientSeed.textContent = cSeed;
        fairNonce.textContent = data.nonce;
        fairRoll.textContent = data.roll.toFixed(8);
        fairThreshold.textContent = data.win_chance.toFixed(8);

        if (musicEnabled) {
          createBackgroundMusic();
        }
        betButton.disabled = false;
        isProcessingBet = false;
      }, 1200);

    } catch (error) {
      setTimeout(() => {
        balance = originalBalance;
        updateBal();
        saveSettings();
        
        let errorMessage = error.message;
        
        if (error.name === 'AbortError' || error.name === 'TimeoutError') {
          errorMessage = 'Request timed out. Check your connection and try again.';
        } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
          errorMessage = 'Network error. Please check your connection.';
        }
        
        errorText.textContent = `Error: ${errorMessage}`;
        betButton.disabled = false;
        isProcessingBet = false;
        
        coin.classList.remove("tossing");
        hand.classList.remove("flicking");
        coinLabel.textContent = "Error occurred - bet refunded";
        if (musicEnabled) {
          createBackgroundMusic();
        }
      }, 1200);
    }
  }

  betButton.addEventListener("click", playRound);
  
  verifyBtn.addEventListener("click", () => {
    if (!currentGameData) {
      alert("No game data available to verify. Play a round first!");
      return;
    }
    
    const verificationText = `
üîê PROVABLY FAIR VERIFICATION

Game Details:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Server Seed Hash: ${currentGameData.serverSeedHash}
Client Seed: ${currentGameData.clientSeed}
Nonce: ${currentGameData.nonce}

Results:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Roll: ${currentGameData.roll.toFixed(8)}
Win Threshold: ${currentGameData.winChance.toFixed(8)}
Result: ${currentGameData.result.toUpperCase()}

Bet: $${currentGameData.bet.toFixed(2)}
Multiplier: ${currentGameData.multiplier}x

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Verification Formula:
HMAC-SHA256(server_seed, client_seed:nonce)

The roll is generated using HMAC-SHA256 with:
- Server seed (hashed for security)
- Your client seed
- A nonce counter

Result is verifiable and cannot be manipulated!
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Copy this data to verify independently using any HMAC-SHA256 calculator.
    `.trim();
    
    alert(verificationText);
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(verificationText).then(() => {
        console.log("Verification data copied to clipboard");
      }).catch(err => {
        console.log("Could not copy to clipboard:", err);
      });
    }
  });

});
</script>

</body>
</html>
